function raster2height(data) {

    var height = new Float32Array(256 * 256 );

    var x, y, i, j;

    for (x = 0; x < 256; x++) {
        for (y = 0; y < 256; y++) {
            i = x + y * 256;
            j = i * 4;
            if(data[j+0]<255)
            height[i] = (data[j] *256 * 256 + data[j + 1] * 256 + data[j + 2])/100 -12; 
            else height[i]=-20;          
        }
    }

    return height;
}

var COLORS = [ 
[12, 49, 124, 255], 
[15 , 55,124 ,255],
[15 ,64,126 ,255],
[17,73,127 ,255],
[18,82,127 ,255],
[20,90,129 ,255],
[22,100,130 ,255],
[24,108,131 ,255],
[26,117,132 ,255],
[28,126,133 ,255],
[29,135,134,255],
[31,144,135,255],
[33,152,136,255],
[35,158,137,255],
[38,163,128,255],
[44,170,116,255],
[49,176,104,255],
[54,183,92 ,255],
[60,190,80 ,255],
[66,196,68 ,255],
[72,203,56 ,255],
[77,209,44 ,255],
[83,216,31,255],
[88,222,20,255],
[94,229,8 ,255],
[97,233,1 ,255],
[114,234,1,255],
[139,237,2,255],
[162,240,2,255],
[185,241,2 ,255],
[209,244,2 ,255],
[233,246,2,255],
[252,248,3,255],
[250,241,5 ,255],
[246,232,8 ,255],
[243,222,12 ,255],
[240,213,15 ,255],
[236,204,19 ,255],
[233,195,22 ,255],
[230,185,25 ,255],
[226,176,28 ,255],
[223,167,32 ,255],
[219,158,35 ,255],
[216,149,38 ,255],
[213,139,42 ,255],
[210,130,45 ,255],
[206,121,48 ,255],
[203,111,51 ,255],
[0,0,0,0]
];

function color(height, min, max, below, above) {

    var px = new Uint8ClampedArray(256 * 256 * 4),
        x, y, i, range;
    range = (max - min)/48;

    for (x = 0; x < 256; x++) {
        for (y = 0; y < 256; y++) {
            i = (y * 256 + x);

            var nap  = height[i]; // nap
            var j;
            if(nap === undefined) j = 48;            
            else if(nap < min) j = below?0:48;
            else if(nap > max) j =above?46:48;
            else j = Math.floor((nap - min)/range);
            i = (y * 256 + x) * 4;
            var c = COLORS[j];
            px[i]     = c[0];
            px[i + 1] = c[1];
            px[i + 2] = c[2];
            px[i + 3] = c[3];
        }
    }
    return px;
}